<html>
    <head>
        <title>Update your info!</title>
        <script src="https://cdn.firebase.com/js/client/2.2.9/firebase.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script>
            
            function Redirect() {
               window.location="login.html";
            }
            
            function Redirect_profile(){
                window.location = "profile.html";
            }
                        
            //Reference variable for the primary database
            var ref = new Firebase("https://blistering-heat-273.firebaseio.com");
            
            var logincheck = function(){
                var authData = ref.getAuth();
                console.log(authData);
                if (authData) {

                    console.log("Authenticated user with uid:", authData.uid);
                    
                    if(authData.provider == "facebook"){
                        email = authData.facebook.email;
                    } else {
                        email = authData.password.email;
                    }
                    
                } else {

                    //Incase the user is not authorised or logged in and opens this page directly
                    //The user gets redirected to the register or login page.
                    Redirect();
                }
            };
            
            
            
            var usersRef = new Firebase("https://blistering-heat-273.firebaseio.com/users");
            
            function setDetails(){
                    logincheck();
                    usersRef.child(email.toLowerCase().replace(/\W+/g, "")).update({
                        reg_year: document.getElementById('reg_year').value,
                        department: $('input[name=dept]:checked').val(),
                        wbut_roll: document.getElementById('wbut_roll').value,
                        last_login_time: Firebase.ServerValue.TIMESTAMP
                    });
                       
                    Redirect_profile();
            };
            
        </script>
    </head>
    <body>
        <li><label>Registration Year: </label><input id="reg_year" type="number" max="2015" min="2008"></li>
        <li><label>Department: </label>
            <input name="dept" type="radio" value="CSE" checked>CSE
            <input name="dept" type="radio" value="ME">ME
            <input name="dept" type="radio" value="CE">CE
            <input name="dept" type="radio" value="EE1">EE1
            <input name="dept" type="radio" value="EE2">EE2
            <input name="dept" type="radio" value="ECE1">ECE1
            <input name="dept" type="radio" value="ECE2">ECE2
        </li>
        <li><label>WBUT Roll No.: </label><input id="wbut_roll" type="number"></li>
        <button onclick="setDetails()">Update</button>
    </body>
</html>