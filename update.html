<html>
    <head>
        <title>Update your info!</title>
        <script src="https://cdn.firebase.com/js/client/2.2.9/firebase.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script>
            
            function Redirect() {
               window.location="login.html";
            }
            
            function Redirect_profile(){
                window.location = "profile.html";
            }
                        
            //Reference variable for the primary database
            var ref = new Firebase("https://blistering-heat-273.firebaseio.com");
            
            var logincheck = function(){
                var authData = ref.getAuth();
                console.log(authData);
                if (authData) {

                    console.log("Authenticated user with uid:", authData.uid);

                    //reference to the user collection which is the child of the primary database
                    var usersRef = ref.child("users");
                    if(authData.provider == "facebook"){
                        email = authData.facebook.email;
                    } else {
                        email = authData.password.email;
                    }
                    
                    console.log("I am here");
                    //Updates the already registered person with the necessary infos
                    usersRef.child(email.toLowerCase().replace(/\W+/g, "")).set({
                        //Last login time updated
                        last_login_time: Firebase.ServerValue.TIMESTAMP
                    });

                } else {

                    //Incase the user is not authorised or logged in and opens this page directly
                    //The user gets redirected to the register or login page.
                    Redirect();
                }
            };
            
            
            
            var usersRef = ref.child("users");
            
            function setDetails(){
                    logincheck();
                    usersRef.child(email.toLowerCase().replace(/\W+/g, "")).set({
                    reg_year: document.getElementById('reg_year').value,
                    department: $('input[name=dept]:checked').val()
                        
                });
            };
            
        </script>
    </head>
    <body>
        <li><label>Registration Year: </label><input id="reg_year" type="number" max="2015" min="2008"></li>
        <li><label>Department: </label>
            <input name="dept" type="radio" value="CSE" checked>CSE
            <input name="dept" type="radio" value="ME">ME
            <input name="dept" type="radio" value="CE">CE
            <input name="dept" type="radio" value="EE1">EE1
            <input name="dept" type="radio" value="EE2">EE2
            <input name="dept" type="radio" value="ECE1">ECE1
            <input name="dept" type="radio" value="ECE2">ECE2
        </li>
        <button onclick="setDetails()">Update</button>
    </body>
</html>